<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-20">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.min.js"></script>
    <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <!-- MENU LATERAL -->

        <div id="menu">
            <div class="logo">
                <h1>In<span>Flow</span></h1>
            </div>
            <div class="escolha">
                <div class="box">
                    <div class="icon">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <p class="titulo">Dashboard</p>
                </div>
                <div class="box">
                    <div class="icon">
                        <i class="fa-solid fa-users"></i>
                    </div>
                    <a href="cadastro.html" class="titulo">Adicionar usuários</a>
                </div>
                <div class="box">
                    <div class="icon">
                        <i class="fa-solid fa-gear"></i>
                    </div>
                    <p class="titulo">Configurações</p>
                </div>
                <div class="box btn-logout" onclick="limparSessao()">
                    <div class="icon"></div>
                    <p class="titulo">Sair</p>
                </div>
            </div>
            <div class="dadosPerfil">
                <div class="fotoPerfil conteudo">
                    <img src="assets/img/homem1.jpg" alt="">
                </div>
                <div class="infoPerfil conteudo">
                    <p class="nome">Renato</p>
                    <p class="email">renato.silva@gmail.com</p>
                </div>
                <div class="maisInfo conteudo">
                    <i class="fa-solid fa-angle-right"></i>
                </div>
            </div>
        </div>
        <!-- FIM DO MENU LATERAL -->
        <div id="main">
            <div class="conteudoDashboard">
                <div class="elementosKPI">
                    <div class="kpi k1">
                        <p class="titulo">Corredor com maior fluxo</p>
                        <div class="dados">
                            <p>Corredor 6</p>
                            <p>:</p>
                            <p>55</p>
                        </div>
                    </div>
                    <div class="kpi k2">
                        <p class="titulo">Corredor com menor fluxo</p>
                        <div class="dados">
                            <p>Corredor 1</p>
                            <p>:</p>
                            <p>21</p>
                        </div>
                    </div>
                    <div class="kpi k3">
                        <p class="titulo">Horário com maior fluxo</p>
                        <div class="dados">
                            <p>18:00</p>
                            <p>:</p>
                            <p>88</p>
                        </div>
                    </div>
                    <div class="kpi k4">
                        <p class="titulo">Horário com menor fluxo</p>
                        <div class="dados">
                            <p>11:00</p>
                            <p>:</p>
                            <p>32</p>
                        </div>
                    </div>
                </div>
                <div class="conteudoGrafico">
                    <div class="grafico ">
                        <canvas id="grafico1"></canvas>
                    </div>
                    <div class="grafico ">
                        <canvas id="grafico2"></canvas>
                    </div>
                </div>

                <div class="controles">
                    <div>
                        <h3>Intervalo de Tempo</h3>
                        <p>Selecione um intervalo de tempo para visualizar os dados:</p>
                    </div>
                    <div class="data-hora">
                        <label for="data-inicial">Data Inicial:</label>
                        <input type="date" id="data-inicial" name="data-inicial" value="2024-01-01">
                        <br>
                        <br>
                        <label for="data-final">Data Final:</label>
                        <input type="date" id="data-final" name="data-final" value="2024-10-01">
                    </div>
                    <div class="data-hora">
                        <label for="hora">Hora Intervalo:</label>
                        <select id="hora" name="hora">
                            <option value="00:00-01:00">00:00 - 01:00</option>
                            <option value="01:00-02:00">01:00 - 02:00</option>
                            <option value="02:00-03:00">02:00 - 03:00</option>
                            <option value="03:00-04:00">03:00 - 04:00</option>
                            <option value="04:00-05:00">04:00 - 05:00</option>
                            <option value="05:00-06:00">05:00 - 06:00</option>
                            <option value="06:00-07:00">06:00 - 07:00</option>
                            <option value="07:00-08:00">07:00 - 08:00</option>
                            <option value="08:00-09:00">08:00 - 09:00</option>
                            <option value="09:00-10:00">09:00 - 10:00</option>
                            <option value="10:00-11:00">10:00 - 11:00</option>
                            <option value="11:00-12:00">11:00 - 12:00</option>
                            <option value="12:00-13:00">12:00 - 13:00</option>
                            <option value="13:00-14:00">13:00 - 14:00</option>
                            <option value="14:00-15:00">14:00 - 15:00</option>
                            <option value="15:00-16:00">15:00 - 16:00</option>
                            <option value="16:00-17:00">16:00 - 17:00</option>
                            <option value="17:00-18:00">17:00 - 18:00</option>
                            <option value="18:00-19:00">18:00 - 19:00</option>
                            <option value="19:00-20:00">19:00 - 20:00</option>
                            <option value="20:00-21:00">20:00 - 21:00</option>
                            <option value="21:00-22:00">21:00 - 22:00</option>
                            <option value="22:00-23:00">22:00 - 23:00</option>
                            <option value="23:00-00:00">23:00 - 00:00</option>
                        </select>
                    </div>
            
            
                    <button onclick="filtrarDadosPorDataHora()">Aplicar Intervalo de Tempo</button>
                </div>
            
                <!-- Div para exibir o heatmap -->
                <div class="conteudo">
                    <div class="heatmap"></div>
                    <div class="rank">
                        <ul>
                            <li><a href="">Corredor 1</a></li>
                            <li><a href="">Corredor 2</a></li>
                            <li><a href="">Corredor 3</a></li>
                            <li><a href="">Corredor 4</a></li>
                            <li><a href="">Corredor 5</a></li>
                            <li><a href="">Corredor 6</a></li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
</body>

</html>
<script>
    // Criar uma instância do heatmap.js
    var instanciaHeatmap = h337.create({
        container: document.querySelector('.heatmap')
    });

    // Estrutura de dados separada por locais, cada local tem várias capturas de dados com datas e horários
    var dadosPorLocal = {
        local1: [
            { x: 95, y: 175, value: 30, radius: 130, dataHora: '2024-10-01T10:30' },
            { x: 95, y: 175, value: 40, radius: 130, dataHora: '2024-10-01T11:15' },
            { x: 95, y: 175, value: 50, radius: 130, dataHora: '2024-10-01T11:45' }
        ],
        local2: [
            { x: 310, y: 225, value: 20, radius: 90, dataHora: '2024-10-02T10:45' },
            { x: 310, y: 225, value: 30, radius: 90, dataHora: '2024-10-02T11:20' },
            { x: 310, y: 225, value: 40, radius: 90, dataHora: '2024-10-02T11:50' }
        ],
        local3: [
            { x: 545, y: 190, value: 60, radius: 100, dataHora: '2024-10-01T11:10' },
            { x: 545, y: 190, value: 70, radius: 100, dataHora: '2024-10-01T11:30' },
            { x: 545, y: 190, value: 80, radius: 100, dataHora: '2024-10-01T12:00' }
        ],
        local4: [
            { x: 190, y: 364, value: 50, radius: 130, dataHora: '2024-10-02T11:00' },
            { x: 190, y: 364, value: 60, radius: 130, dataHora: '2024-10-02T11:40' },
            { x: 190, y: 364, value: 70, radius: 130, dataHora: '2024-10-02T12:15' }
        ],
        local5: [
            { x: 400, y: 365, value: 80, radius: 130, dataHora: '2024-10-03T11:05' },
            { x: 400, y: 365, value: 40, radius: 130, dataHora: '2024-10-03T11:35' },
            { x: 400, y: 365, value: 50, radius: 130, dataHora: '2024-10-03T12:10' }
        ]
    };

    // Função para converter data e hora em um objeto Date
    function converterParaDataCompleta(data, hora) {
        return new Date(`${data}T${hora}`);
    }

    // Função para aplicar o filtro de intervalo de data e hora e adicionar os dados ao heatmap
    function filtrarDadosPorDataHora() {
        var dataInicial = document.getElementById('data-inicial').value;
        var dataFinal = document.getElementById('data-final').value;
        var horaIntervalo = document.getElementById('hora').value;

        // Separar a hora inicial e final do intervalo selecionado
        var horas = horaIntervalo.split("-");
        var horaInicial = horas[0];
        var horaFinal = horas[1];

        // Converter os dados e horários em objetos Date
        var dataHoraInicial = converterParaDataCompleta(dataInicial, horaInicial);
        var dataHoraFinal = converterParaDataCompleta(dataFinal, horaFinal);

        if (dataHoraFinal < dataHoraInicial) {
            alert("A data e hora final devem ser maiores ou iguais à data e hora inicial.");
            return;
        }

        // Limpar o heatmap antes de adicionar novos dados
        instanciaHeatmap.setData({ max: 0, data: [] });

        // Percorrer todos os locais
        for (var local in dadosPorLocal) {
            var dadosDoLocal = dadosPorLocal[local];

            // Percorrer cada ponto de dados dentro de um local
            for (var i = 0; i < dadosDoLocal.length; i++) {
                var ponto = dadosDoLocal[i];
                var dataHoraPonto = new Date(ponto.dataHora);

                // Verificar se o ponto de dados está dentro do intervalo de data e hora
                if (dataHoraPonto >= dataHoraInicial && dataHoraPonto <= dataHoraFinal) {
                    // Usando addData para adicionar os pontos ao heatmap
                    instanciaHeatmap.addData(ponto);
                }
            }
        }
    }

    // Carregar os dados iniciais
    filtrarDadosPorDataHora();


    // renderCalendar();
    const ctx1 = document.getElementById('grafico1');
    // const ctx2 = document.getElementById('grafico2');

    const grafico1 = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
            datasets: [{
                label: 'Pessoas',
                data: [39, 32, 65, 35, 67, 54, 76, 54, 88, 34],
                borderWidth: 1,
                borderColor: '#115e59',
                backgroundColor: '#115e59'
            }]
        },
        options: {

            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Movimentação por horário',
                    font: {
                        size: 24
                    },
                    color: '#333'
                }
            }
        }
    })
    const ctx2 = document.getElementById('grafico2');
    const grafico2 = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Corredor 1', 'Corredor 2', 'Corredor 3', 'Corredor 4', 'Corredor 5', 'Corredor 6', 'Corredor 7', 'Corredor 8', 'Corredor 9', 'Corredor 10'],
            datasets: [{
                label: 'Pessoas', //<- legenda da tabela
                data: [10, 22, 43, 32, 11, 54, 43, 21, 55, 53], //<- muda o valor dos dados no grafico para adicionar mais valores é necessario adicionar mais corredores acima
                borderWidth: 1,
                borderColor: '#115e59',
                backgroundColor: '#115e59'
            }]
        },
        options: {
            tension: 0.5,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Movimentação por corredor',
                    font: {
                        size: 24
                    },
                    color: '#333' // (opcional) cor do título
                }
            }
        }
    }

    )
</script>